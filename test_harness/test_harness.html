<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="harness_server.js"></script>
</head>
<body>
    <form action="set_price" method="GET" name="discount_form">
        <label for="productDropdown">Select a product: </label>
        <select class="form-select" id="productDropdown" style="width: 250px;" name="productDropdown">
            <option value="*">All products</option>
        </select>

        <br>

        <label for="discountInput">Set a discount: </label>
        <input type="number" autocomplete="off" placeholder="0" max="99" min="-99" name="discountInput" id="discountInput" oninput="limitChar(this)">

        <br>
        <label for="dynamicPricing">Apply dynamic pricing: </label>
        <input type="checkbox" id="dynamicPricing" name="dynamicPricing" onchange="removeDiscount(this)">

        <br>
        <br>
        <input type="submit">
    </form>
    <br>
    <table style="border: 1px solid black;">
        <tr>
            <th>HRS</th><th>DISC</th>
        </tr>
        <tr>
            <td>24</td><td>10</td>
        </tr>
        <tr>
            <td>48</td><td>30</td>
        </tr>
        <tr>
            <td>72</td><td>60</td>
        </tr>
        <tr>
            <td>96</td><td>95</td>
        </tr>
    </table>

    <p id="errorMsg"></p>

    <script>
        var selectElement = document.getElementById("productDropdown");
        // Generate the dropdown by retrieving the products
            // The dropdown value is the product's item_id
            // But the text displayed on the screen is the product's name
        Object.values(products).forEach(category => {
            category.forEach(product => {
                var optionElement = document.createElement("option");
                optionElement.value = product.item_id;
                optionElement.textContent = `${product.name} - ${product.item_id}`;
                selectElement.appendChild(optionElement);
            });
        });

        // Limit the number of characters entered in the input box
        // 3 characters for negative numbers
        // 2 characters for positive numbers
        function limitChar(input) {
            var limit = 2;
            let value = input.value.trim();
            if (value.startsWith('-')) limit++;
            if (value.length > limit) {
                value = value.slice(0, limit);
                input.value = value;
            }
            // May take out
            // If user enters a character other than - and a number, the input box value is deleted
            let userInput = input.value;
            if (isNaN(userInput) || (userInput !== "-" && (Number(userInput) < -99 || Number(userInput) > 99))) {
                input.value = "";
            }
        }
        
        // If dynamic pricing is selected, make it so users aren't able to set a custom discount
        function removeDiscount(checkbox) {
            if (checkbox.checked) {
                discountInput.disabled = true;
                discountInput.value = 0;
            }
            else {
                discountInput.disabled = false;
            }
        }
    </script>
</body>
</html>
